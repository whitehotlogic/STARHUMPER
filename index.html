<!doctype html> 
<html lang="en"> 
<head> 
    <meta charset="UTF-8" />
    <title>StarHump</title>
    <script src="//cdn.jsdelivr.net/phaser/2.6.1/phaser.min.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>

<script type="text/javascript">

var game = new Phaser.Game(800, 600, Phaser.CANVAS, 'StarHump', { preload: preload, create: create, update: update, render: render });

function preload() {

    // load images and spritesheets
    game.load.image('player', 'assets/player.png');
    game.load.image('star', 'assets/star.png');
    game.load.spritesheet('blackhole', 'assets/blackhole.png', 50, 50);
    // load sounds
    game.load.audio('hump1', 'assets/sounds/hump1.mp3');
    game.load.audio('hump2', 'assets/sounds/hump2.mp3');
    game.load.audio('hump3', 'assets/sounds/hump3.mp3');
    game.load.audio('hump4', 'assets/sounds/hump4.mp3');
    game.load.audio('hump5', 'assets/sounds/hump5.mp3');
    game.load.audio('hump6', 'assets/sounds/hump6.mp3');
    game.load.audio('hump7', 'assets/sounds/hump7.mp3');
    game.load.audio('capturestar', 'assets/sounds/capturestar.mp3');
    
}


var blackholes;


function create() {

    // capture user input (player controls)
    cursors = game.input.keyboard.createCursorKeys();
    
    // create the sprite objects and enable physics for them
    star = game.add.sprite(400, 200, 'star');
    player = game.add.sprite(400, 200, 'player');

/*    OLD BLACKHOLES CODE

    // create blackholes group

    //  The platforms group contains the ground and the 2 ledges we can jump on
    blackholes = game.add.group();

    //  We will enable physics for any object that is created in this group
    blackholes.enableBody = true;


    //  Now let's create two blackholes
    var blackhole = blackholes.create(10, 200, 'blackhole');
    blackhole.body.immovable = true;
    blackhole.animations.add('spin'); // add default anim for blackhole
    blackhole.animations.play('spin', 20, true); // start blackhole anim @ 30fps
    // blackhole 2
    blackhole = blackholes.create(10, 400, 'blackhole');
    blackhole.body.immovable = true;
    blackhole.animations.add('spin'); // add default anim for blackhole
    blackhole.animations.play('spin', 20, true); // start blackhole anim @ 30fps
*/

    // create 5 blackholes
    blackholes = game.add.physicsGroup(Phaser.Physics.ARCADE);
    for (var i = 0; i < 5; i++)
    {
        var s = blackholes.create(game.rnd.integerInRange(100, 700), game.rnd.integerInRange(32, 200), 'blackhole');
        s.animations.add('spin');
        s.play('spin', 20, true);
        //s.body.velocity.set(game.rnd.integerInRange(-200, 200), game.rnd.integerInRange(-200, 200));
    }

    //blackholes.setAll('body.collideWorldBounds', true);
    blackholes.setAll('body.immovable', true);
    //blackholes.setAll('body.onCollide', "(endGame, this)");





    // start the phaser.io arcade physics!!!
    game.physics.startSystem(Phaser.Physics.ARCADE);
    game.physics.enable([player,star,blackholes], Phaser.Physics.ARCADE);
    
    // specify physics for sprites
    player.body.immovable = true;
    //blackhole.body.immovable = true; 


    // gets the star moving at the beginning of the game
    star.body.velocity.setTo(200, 200);

    // make the star bounce off the walls
    star.body.collideWorldBounds = true;
    // make the player collide with walls
    //player.body.collideWorldBounds = true; //disabled because less fun

    // sets the image bounce energy for the horizontal 
    //  and vertical vectors (as an x,y point). "1" is 100% energy return
    star.body.bounce.setTo(1, 1);


    // make collision event so sounds happen on player collide with star
    player.body.onCollide = new Phaser.Signal();
    player.body.onCollide.add(playerHump, this);
    

    // make collision event so game reacts if blackhole gets hit by player or star
    //blackholes.body.onCollide = new Phaser.Signal();
    //blackholes.body.onCollide.add(endGame, this);

}


function update () {

    // enable physics between the sprites
    game.physics.arcade.collide(player, star);
    //game.physics.arcade.collide(player, blackholes);
    game.physics.arcade.collide(star, blackholes, endGame);
    game.physics.arcade.collide(player, blackholes, endGame);


    // move the player around the screen with arrow keys
    if (cursors.up.isDown)
    {
        player.body.velocity.y = -300;
    }
    else if (cursors.down.isDown)
    {
        player.body.velocity.y =  300;
    }
    else if (cursors.left.isDown)
    {
        player.body.velocity.x = -300;
    }
    else if (cursors.right.isDown)
    {
        player.body.velocity.x = 300;
    } 
    else
    {
        player.body.velocity.setTo(0, 0);
    }
    
}

function render () {

    //debug helper
    game.debug.spriteInfo(star, 32, 32);

}

// ---------------------------------------------
// game specific, non-phaser.io functions below

function playerHump () {

    // get a random hump sound
    var humpRand = Math.floor(Math.random() * 7) + 1; //random 1-7
    var hump = game.add.audio('hump'+humpRand);
    hump.pause(); // stop prior hump sounds, so humps don't overlap as much
    hump.play();

}

function endGame (sprite1, sprite2) {

    if (sprite1.key == "star") {
        // play blackhole-capturing-star sound
        var blackholeSound = game.add.audio('capturestar');
        blackholeSound.play();
        console.log("blackhole collision with star -- game won");
    } else if (sprite1.key == "player") {
        console.log("blackhole collision with player -- game lost");
    } else {
        console.log("blackhole collision with unknown sprite -- IMPOSSIBLE")
    }

    //console.log("endGame");
    

}

</script>

</body>
</html>